<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bean There ‚Äì Profile</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #efe8d6;
      --sidebar: #5b5f10;
      --accent: #7f7b2e;
      --muted: #bfb0a8;
      --content-width: 1500px;
      --review-bg: #dce6f7; /* Light blue from the image */
      --review-title: #d35f0f; /* Orange cafe name color */
    }

    *{box-sizing:border-box}
    html,body{
      height:100%;
      margin:0;
      font-family:Montserrat, system-ui, sans-serif;
      background:var(--bg);
      color:#2b2b2b;
    }

    .frame{
      width:100%;
      height:100vh;
      overflow:hidden;
    }

    .layout{
      display:grid;
      grid-template-columns:260px 1fr;
      height:100%;
      column-gap:18px;
    }

    /* SIDEBAR */
    .sidebar{
      background:var(--sidebar);
      color:#fff;
      padding:28px;
      margin:18px 0 18px 18px;
      border-radius:22px;
      height:calc(100% - 36px);
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }

    .logo{
      font-family:Lora, serif;
      font-size:42px;
      font-weight:700;
      letter-spacing:1px;
    }

    .nav{
      margin-top:36px;
      display:flex;
      flex-direction:column;
      gap:26px;
    }

    .nav a{
      color:#fff;
      text-decoration:none;
      font-size:20px;
    }

    .auth{font-size:20px}

    .sidebar .nav a:hover,
    .sidebar .auth div:hover{
      color:#fa7a11;
      cursor:pointer;
      transition:0.3s;
    }
    /* Animation Keyframes */
@keyframes floatUp {
  from { opacity: 0; transform: translateY(40px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Animation Classes */
.animate-on-load {
  opacity: 0;
  animation: floatUp 0.9s ease-out forwards;
}

.delay-1 { animation-delay: 0.15s; }
.delay-2 { animation-delay: 0.35s; }

/* Ensure both containers share the same base layout */
#reviewContainer, #repliesContainer {
  display: flex;
  width: 100%;
  min-height: 220px; /* Aligns height better with the review card */
}

/* Specific fix for the replies container to match the blue box */
/* Force the replies carousel to match the main review carousel exactly */
#repliesContainer {
  background-color: #dce6f7 !important;
  min-height: 180px;
  padding: 0; /* Remove padding so the card inside touches the edges if needed */
  display: flex;
  align-items: stretch; /* Ensures the card fills the height */
}

/* Ensure the review card inside the replies container doesn't add extra margin */
#repliesContainer .review-card {
  width: 100%;
  box-shadow: none; /* Optional: remove shadow if it looks too 'heavy' inside the blue box */
  margin: 0;
}

    /* MAIN */
    .main{
      height:calc(100% - 36px);
      margin:18px 18px 0 0;
      padding:20px 20px;
      border:1.5px solid rgba(127,123,46,0.4);
      border-radius:24px;
      overflow-y:auto;
      position:relative;
    }

    .search-area{
      flex: 1;          /* ‚¨Ö THIS IS THE KEY */
      display: flex;
    }

    .search-row{
      display: flex;
      align-items: center;
      gap: 28px;
      max-width: var(--content-width);
      margin: 0 auto;          /* center the whole row */
      margin-bottom: 24px; 
    }

    .search-wrap{
      flex: 1;                 /* ‚¨Ö key line */
      display: flex;
    }

    #q{
      font-family:Montserrat, system-ui, sans-serif;
    }

    .search{
      width:100%;
      max-width:var(--content-width);
      height: 50px;
      padding: 0 16px;
      border-radius:40px;
      border:1.5px solid rgba(127,123,46,0.4);
      background:#eee0c5;
      display:flex;
      align-items:center;
    }

    .search input{
      flex:1;
      border:0;
      background:transparent;
      outline:none;
      font-size:18px;
      line-height: 22px;
      color:#6d6910;
    }

    .search input::placeholder{
      color:#8a8f7a;
    }

    .search button{
      border:0;
      background:transparent;
      cursor:pointer;
    }

    .search button img{
      width: 18px;
      height: 18px;
      display: block;
    }

    /* modal avatar preview small tweaks */
#modalAvatarPreview{ border-radius:50%; display:block; }
#inputAvatar{ font-size:14px; }
#removeAvatarBtn{ background:transparent; }
#removeAvatarBtn:hover{ background:rgba(0,0,0,0.04); }

    /* Modal for Edit Profile */
.modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:1600; }
.modal[hidden]{ display:none; }
.modal-backdrop{ position:absolute; inset:0; background:rgba(0,0,0,0.22); border-radius:12px; }
.modal-panel{
  position:relative;
  background: #fff;
  width: min(680px, calc(100% - 48px));
  border-radius:12px;
  padding:18px;
  box-shadow: 0 18px 40px rgba(0,0,0,0.18);
  border:1px solid rgba(0,0,0,0.06);
  z-index:2;
  font-family: inherit;
}

/* small utility classes */
.modal-close{ background:transparent;border:0;font-size:18px;cursor:pointer;padding:6px; }
.btn-secondary:hover{ background: rgba(0,0,0,0.04); }
.btn-primary{ background:var(--accent); color:#fff; border-radius:8px; }

/* ensure form controls readable on small screens */
@media(max-width:520px){
  .modal-panel{ 
    width: calc(100% - 32px); 
    padding:14px; 
  }
}

    /* PROFILE HEADER */
    .profile-header{
      display:flex;
      align-items:flex-start;
      gap:22px;
      max-width:var(--content-width);
      margin:6px auto 30px;
    }

    .profile-avatar{
      flex:0 0 auto;
    }

    .avatar-large{
      width:120px;
      height:120px;
      border-radius:50%;
      overflow:hidden;
      border:8px solid #dfe7e5;
      background:#fff;
      flex:0 0 120px;
    }
    .avatar-large img{ width:100%; height:100%; object-fit:cover; display:block; }

    .profile-meta{
      flex:1;
    }
    .profile-meta h1{
      margin-top: 8px; /* Adjust this value (e.g., 2px to 8px) to taste */
  margin-bottom: 0;
  font-size: 44px;
  line-height: 1;
  font-weight: 700;
  letter-spacing: -0.5px;
    }
    .profile-meta .handle{
      color:#2b5b6f;
      margin-top:6px;
      font-size:16px;
      font-weight:600;
    }
    .profile-meta p{
      margin:10px 0 0;
      color:var(--muted);
    }

    .edit-btn{
      display:inline-block;
      margin-top:12px;
      padding:8px 16px;
      border-radius:20px;
      border:1.5px solid rgba(127,123,46,0.4);
      background:transparent;
      cursor:pointer;
      font-weight:600;
    }

    /* Sections */
    .section{
      max-width:var(--content-width);
      margin:28px auto;
    }
    .section h2{
      font-size:32px;
      margin:0 0 18px;
      letter-spacing:-0.3px;
      text-align: center;
    }
    /* ----- user dropdown ----- */
    .user-menu{ 
      position:relative; 
      display:inline-block; 
      flex:0 0 auto; 
    }
    .user-mini-btn{
      width:50px;
      height: 50px;
      border-radius:50%;
      padding:0;
      border:5px solid rgba(127,123,46,0.15);
      background:#fff;

      display:inline-flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;

      box-sizing:border-box;
    }
    .user-mini-btn img{ 
      display:block;
      width:100%; 
      height:100%; 
      object-fit:cover; 
      border-radius:50%; 
    }

/* dropdown panel */
.user-dropdown{
  position:absolute;
  top:calc(100% + 12px);
  right:0;
  width:270px;
  background:#fff;
  border-radius:12px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.12);
  border:1px solid rgba(0,0,0,0.06);
  padding:10px;
  z-index:1200;
  font-size:15px;
}

/* header */
.ud-header{ padding:8px 10px; text-align:left; }
.ud-greet{ font-weight:700; color:#111; font-size:15px; }
.ud-sub{ color:#6b6b6b; margin-top:4px; font-size:13px; }

/* divider */
.ud-divider{ height:1px; background:rgba(0,0,0,0.06); margin:8px 0; border-radius:2px; }

/* list */
.ud-list{ list-style:none; padding:0; margin:0; }
.ud-item{
  width:100%;
  text-align:left;
  background:transparent;
  border:0;
  padding:10px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}
.ud-item:hover{ background:rgba(127,123,46,0.06); }

/* signout */
.ud-signout{ padding:8px 10px; text-align:left; }
.ud-signout-btn{
  width:100%;
  background:transparent;
  border:0;
  padding:10px;
  border-radius:8px;
  color:#111;
  cursor:pointer;
  font-weight:700;
}
.ud-signout-btn:hover{ background:rgba(255,80,60,0.06); }

/* small screens: keep dropdown within viewport */
@media(max-width:520px){
  .user-dropdown{ right:8px; left:8px; width:auto; }
}


    /* carousel styles */
    .carousel-wrapper{
      position: relative;
      padding: 0 48px; /* space for arrows */
    }

    .carousel{
      /* Removed fixed background and height to accommodate review card */
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      width: 100%;
    }

    /* FIXED: Changed selector from .carousel .arrow to .carousel-wrapper .arrow */
    /* FIXED: Solid Orange Arrows */
    .carousel-wrapper .arrow {
      position: absolute;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #ee6a45 !important; /* Solid orange from your design */
      color: #fff !important;
      opacity: 1 !important; /* Forces the arrow to be fully opaque */
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      cursor: pointer;
      top: 50%;
      transform: translateY(-50%);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      z-index: 20; /* Ensures arrows stay above the blue box */
      font-size: 24px;
      border: none;
    }

    /* FIXED: Solid Blue Review Container */
    .carousel {
      position: relative;
      display: flex;
      width: 100%;
      background-color: #dce6f7 !important; /* Solid light blue */
      border-radius: 20px;
      overflow: hidden;
      opacity: 1 !important; /* Removes the washed-out look */
      min-height: 180px;
    }
    .carousel-wrapper .arrow.left{ left: 0px; }
    .carousel-wrapper .arrow.right{ right: 0px; }

    /* replies carousel larger height */
    .carousel.large{ 
        background: #cfe0ff;
        border-radius:16px;
        padding:28px;
        height:150px; 
    }

    /* --- NEW REVIEW CARD STYLES --- */
    .review-card {
      background-color: var(--review-bg);
      border-radius: 20px;
      padding: 20px;
      display: flex;
      gap: 20px;
      width: 100%;
      text-align: left;
      position: relative; /* For edit button positioning */
    }

    .review-img {
      width: 180px;
      height: 180px;
      border-radius: 16px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .review-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
      font-size: 14px;
      color: #4a5568;
    }

    .review-user {
      font-weight: 700;
      color: #2d3748;
      font-size: 16px;
    }

    .review-date {
      display: block;
      font-size: 13px;
    }
    
    .edited-label {
        font-size: 11px;
        color: #718096;
        font-style: italic;
    }

    .amenities-list {
      display: flex;
      gap: 12px;
      font-size: 13px;
      color: #4a5568;
    }

    .amenity-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .cafe-title-row {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 4px;
    }

    .cafe-name {
      font-family: Lora, serif;
      font-weight: 700;
      font-size: 28px;
      color: var(--review-title);
      margin: 0;
    }

    .rating-beans {
        font-size: 20px;
        letter-spacing: 2px;
    }

    .cafe-address {
      font-weight: 700;
      font-size: 15px;
      color: #2d3748;
      margin-bottom: 12px;
    }

    .review-text {
      font-size: 15px;
      line-height: 1.5;
      color: #4a5568;
      margin: 0 0 20px 0; /* Bottom margin for button space */
      flex-grow: 1;
    }

    .edit-review-btn-container {
        display: flex;
        justify-content: flex-end;
        margin-top: auto;
    }

    .btn-edit-review {
      background: transparent;
      border: 1.5px solid #2d3748;
      border-radius: 20px;
      padding: 8px 20px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-edit-review:hover {
        background: rgba(0,0,0,0.05);
    }


    @media(max-width:980px){
    :root{ --content-width: 820px; }
    .search{ flex:1 1 calc(100% - 64px); max-width: calc(var(--content-width) - 64px); }
    .user-mini{ width:48px; height:48px; flex:0 0 48px; }
    .review-card { flex-direction: column; }
    .review-img { width: 100%; height: 200px; }
    .review-header { flex-direction: column; gap: 10px; }
  }

  @media(max-width:760px){
    .layout{grid-template-columns:1fr}
    .sidebar{order:2;height:auto}
    .main{order:1}
    .user-mini{ display:none; } /* hide mini on very small screens */
    .carousel-wrapper { padding: 0; }
    /* FIXED: Updated selector here too */
    .carousel-wrapper .arrow { display: none; /* hide arrows on mobile, maybe use swipe later */ }
  }
  /* --- NEW: Edit Review Modal Specific Styles --- */
    .edit-review-panel {
      background-color: #f8f5ee; /* Light beige background from image */
      border-radius: 20px;
      padding: 40px 30px;
      width: min(480px, calc(100% - 32px)); /* Fixed width, responsive */
      text-align: center;
      border: none;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .edit-review-header {
      position: relative;
      margin-bottom: 30px;
    }

    .edit-review-header h3 {
      font-family: 'Lora', serif;
      font-size: 32px;
      font-weight: 700;
      color: #4a3f35; /* Dark brown color */
      margin: 0;
      line-height: 1.2;
    }

    .edit-review-header h3 span {
      display: block;
      font-size: 24px;
      margin-top: 5px;
    }

    .modal-close-review {
      position: absolute;
      top: -20px;
      right: -15px;
      background: transparent;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #4a3f35;
      padding: 5px;
    }

    #editReviewText {
      width: 100%;
      padding: 10px;
      border: none;
      background: transparent;
      font-family: 'Montserrat', sans-serif;
      font-size: 18px;
      color: #7f7a75; /* Text color from image */
      resize: none; /* Disable resize handle */
      outline: none;
      text-align: center;
      min-height: 120px;
    }

    #editReviewText::placeholder {
      color: #b0aba5;
    }

    .edit-review-footer {
      margin-top: 30px;
    }

    .btn-save-review {
      background-color: transparent;
      color: #4a3f35;
      border: 2px solid #4a3f35; /* Dark brown border */
      border-radius: 30px;
      padding: 10px 50px;
      font-size: 20px;
      font-weight: 700;
      font-family: 'Montserrat', sans-serif;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-save-review:hover {
      background-color: #4a3f35;
      color: #fff;
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="layout">

      <aside class="sidebar animate-on-load delay-1">
        <div>
          <div class="logo">bean<br>there</div>
          <nav class="nav">
            <a href="index.html">Home</a>
            <a href="profile.html">Profile</a>
            <a href="tbv.html">TBV</a>
            <a href="ratings.html">Ratings</a>
          </nav>
        </div>
        <div class="auth">
          <div style="margin-bottom:14px">Log in</div>
          <div>Sign up</div>
        </div>
      </aside>

      <main class="main animate-on-load delay-2">

        <div class="search-row">
  <div class="search-area" role="search" aria-label="Search cafes owners tags">
    <div class="search" aria-hidden="false">
      <input id="q" placeholder="Search cafes, owners, tags..." />
      <button id="searchBtn">
        <img src="icons/search.png" alt="search">
      </button>
    </div>

    <div class="user-menu" id="userMenu">
  <button id="userMenuBtn" class="user-mini-btn" aria-haspopup="true" aria-expanded="false" aria-controls="userDropdown" title="Open account menu">
    <img id="avatarMiniImg"src="icons/noprof.jpg" alt="profile mini">
  </button>

  <div id="userDropdown" class="user-dropdown" role="menu" aria-labelledby="userMenuBtn" hidden>
    <div class="ud-header">
      <div class="ud-greet">Hi, Erylle Jerica Galinato!</div>
      <div class="ud-sub">Student</div>
    </div>

    <div class="ud-divider" role="separator"></div>

    <ul class="ud-list" role="menu">
      <li role="none"><button role="menuitem" class="ud-item" data-action="profile">Profile</button></li>
      <li role="none"><button role="menuitem" class="ud-item" data-action="contact">Contact Us</button></li>
      <li role="none"><button role="menuitem" class="ud-item" data-action="support">Support Us</button></li>
    </ul>

    <div class="ud-divider" role="separator"></div>

    <div class="ud-signout">
      <button role="menuitem" class="ud-signout-btn" data-action="signout">Sign Out</button>
    </div>
  </div>
</div>

  </div>
</div>

        <div class="profile-header">
          <div class="avatar-large">
  <img id="avatarLargeImg" src="icons/noprof.jpg" alt="profile large">
</div>
          <div id="editProfileModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" hidden>
  <div class="modal-backdrop" data-close></div>

  <div class="modal-panel" role="document">
    <header style="display:flex;align-items:center;justify-content:space-between;">
      <h3 id="modalTitle" style="margin:0">Edit profile</h3>
      <button class="modal-close" aria-label="Close" data-close>‚úï</button>
    </header>

    <form id="editProfileForm" style="margin-top:14px;">
      <div style="display:flex;gap:14px;align-items:center;">
        <div style="flex:0 0 auto; text-align:center;">
          <div style="width:84px; height:84px; border-radius:50%; overflow:hidden; border:2px solid #e6eaea; display:inline-block;">
            <img id="modalAvatarPreview" src="icons/noprof.jpg" alt="preview" style="width:100%; height:100%; object-fit:cover; display:block;">
          </div>
        </div>

        <div style="flex:1;">
          <label for="inputAvatar" style="display:block;font-weight:600;margin-bottom:6px;">Profile picture</label>
          <input id="inputAvatar" type="file" accept="image/*" />
          <div id="avatarHelp" style="font-size:13px;color:#666;margin-top:6px;">PNG/JPG, max 3 MB. Preview shown above.</div>

          <div style="margin-top:8px;">
            <button type="button" id="removeAvatarBtn" style="padding:6px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:transparent;cursor:pointer;">Remove photo</button>
          </div>
        </div>
      </div>

      <label for="inputUsername" style="display:block;margin-top:14px;margin-bottom:6px;font-weight:600;">Username</label>
      <input id="inputUsername" type="text" placeholder="@your_username" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.12);font-size:15px;" required>

      <label for="inputTitle" style="display:block;margin-top:12px;margin-bottom:6px;font-weight:600;">Job Title</label>
      <input id="inputTitle" type="text" placeholder="Job Title" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.12);font-size:15px;">
      <label for="inputBio" style="display:block;margin-top:12px;margin-bottom:6px;font-weight:600;">Short bio</label>
      <textarea id="inputBio" rows="4" placeholder="Write a short bio..." style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.12);font-size:15px;"></textarea>

      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px;">
        <button type="button" class="btn-secondary" data-close style="padding:8px 12px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:transparent;cursor:pointer;">Cancel</button>
        <button type="submit" class="btn-primary" style="padding:8px 14px;border-radius:8px;border:0;background:var(--accent);color:#fff;cursor:pointer;font-weight:700;">Save</button>
      </div>
    </form>
  </div>
</div>



          <div class="profile-meta">
  <h1>Erylle Galinato</h1>
  <div id="handleText" class="handle">@erylle_g</div>
  <p id="bioText">Placeholder for short bio ‚Äî add a couple of lines about yourself here.</p>
  <button id="editProfileBtn" class="edit-btn" aria-haspopup="dialog" aria-controls="editProfileModal">Edit Profile</button>
</div>

        </div>

        <section class="section">
          <h2>My reviews</h2>
          <div class="carousel-wrapper">
            <div class="arrow left" id="prevReviewBtn">‚Äπ</div>
            <div class="arrow right" id="nextReviewBtn">‚Ä∫</div>
            
            <div class="carousel" aria-hidden="false" id="reviewContainer">
                </div>
          </div>
        </section>

        <section class="section" style="margin-top: 40px;">
  <h2>Replies to other reviews</h2>
  <div class="carousel-wrapper">
    <div class="arrow left" id="prevReplyBtn">‚Äπ</div>
    <div class="arrow right" id="nextReplyBtn">‚Ä∫</div>
    
    <div class="carousel" id="repliesContainer">
    </div>
  </div>
</section>

      </main>

    </div>
  </div>

  <div id="editReviewModal" class="modal" role="dialog" aria-modal="true" hidden>
    <div class="modal-backdrop" data-close-review></div>
    <div class="modal-panel edit-review-panel">
      <header class="edit-review-header">
        <h3 id="editReviewTitle">Edit Review</h3>
        <button class="modal-close-review" aria-label="Close" data-close-review>‚úï</button>
      </header>
      <form id="editReviewForm">
        <textarea id="editReviewText" rows="6" placeholder="Write your edit here.."></textarea>
        <div class="edit-review-footer">
          <button type="submit" class="btn-save-review">Save</button>
        </div>
      </form>
    </div>
  </div>
  <script>
    (function(){
  const editBtn = document.getElementById('editProfileBtn');
  const modal = document.getElementById('editProfileModal');
  const closeTriggers = modal ? modal.querySelectorAll('[data-close]') : [];
  const form = document.getElementById('editProfileForm');
  const inputUsername = document.getElementById('inputUsername');
  const inputBio = document.getElementById('inputBio');
  const handleText = document.getElementById('handleText');
  const bioText = document.getElementById('bioText');
// AVATAR ELEMENTS
  const modalPreview = document.getElementById('modalAvatarPreview'); // preview inside modal
  const inputAvatar = document.getElementById('inputAvatar');
  const removeAvatarBtn = document.getElementById('removeAvatarBtn');
  const avatarLarge = document.getElementById('avatarLargeImg'); // big avatar on page
  const avatarMini = document.getElementById('avatarMiniImg');
  // Helpers for localStorage keys
  const LS_USER = 'beanthere_profile_username';
  const LS_BIO = 'beanthere_profile_bio';
  const LS_AVATAR = 'beanthere_profile_avatar'; // stores data URL

  // default fallback src (update to match your original file if different)
  const DEFAULT_LARGE_SRC = avatarLarge ? avatarLarge.getAttribute('src') || 'icons/noprof.jpg' : 'icons/noprof.jpg';
  const DEFAULT_MINI_SRC  = avatarMini ? avatarMini.getAttribute('src') || 'icons/noprof.jpg' : 'icons/noprof.jpg';
  // Load saved values on startup (if any)
 function loadSaved(){
    // Keys used in your Sign Up function
    const LS_NAME   = 'beanthere_profile_fullname';
    const LS_USER   = 'beanthere_profile_username';
    const LS_BIO    = 'beanthere_profile_bio';
    const LS_AVATAR = 'beanthere_profile_avatar';
  // Add these lines to your loadSaved() in profile.html
    const LS_TITLE = 'beanthere_profile_title';
    const savedTitle = localStorage.getItem(LS_TITLE);

    const dropdownSub = document.querySelector('.ud-sub');
    if(savedTitle && dropdownSub) {
    dropdownSub.textContent = savedTitle;
    }
    const savedName   = localStorage.getItem(LS_NAME);
    const savedUser   = localStorage.getItem(LS_USER);
    const savedBio    = localStorage.getItem(LS_BIO);
    const savedAvatar = localStorage.getItem(LS_AVATAR);

    // 1. Update Full Name (the <h1> tag)
    const nameHeading = document.querySelector('.profile-meta h1');
    if(savedName && nameHeading) {
      nameHeading.textContent = savedName;
      // Also update the greeting in the dropdown menu
      const dropdownGreet = document.querySelector('.ud-greet');
      if(dropdownGreet) dropdownGreet.textContent = `Hi, ${savedName}!`;
    }

    // 2. Update Username/Handle
    if(savedUser && handleText) handleText.textContent = savedUser;

    // 3. Update Bio
    if(savedBio && bioText) bioText.textContent = savedBio;

    // 4. Update Avatars
    if(savedAvatar && avatarLarge && avatarMini){
      avatarLarge.src = savedAvatar;
      avatarMini.src = savedAvatar;
      if(modalPreview) modalPreview.src = savedAvatar;
    } else {
      // Revert to default if no avatar is saved
      if(avatarLarge) avatarLarge.src = DEFAULT_LARGE_SRC;
      if(avatarMini)  avatarMini.src  = DEFAULT_MINI_SRC;
      if(modalPreview) modalPreview.src = DEFAULT_LARGE_SRC;
    }
  }

  loadSaved();

  // fill modal inputs with current values before opening
  function openModal(){
    if(!modal) return;
    inputUsername.value = (handleText && handleText.textContent) ? handleText.textContent : '';
    inputBio.value = (bioText && bioText.textContent) ? bioText.textContent : '';
    // preview should already be set from loadSaved
    modal.hidden = false;
    setTimeout(()=> inputUsername.focus(), 30);
  }

  function closeModal(){
    if(!modal) return;
    modal.hidden = true;
    editBtn.focus();
    // clear file input selection (not the preview)
    if(inputAvatar) inputAvatar.value = '';
  }

  function normalizeUsername(val){
    if(!val) return '';
    val = val.trim();
    if(val.length === 0) return '';
    if(val.charAt(0) !== '@') return '@' + val;
    return val;
  }
   // file validation and preview
  if(inputAvatar){
    inputAvatar.addEventListener('change', function(e){
      const file = inputAvatar.files && inputAvatar.files[0];
      if(!file) return;

      // validate type (image) and size (limit: 3 MB)
      const maxBytes = 3 * 1024 * 1024; // 3 MB
      if(!file.type.startsWith('image/')){
        alert('Please choose an image file (png, jpg, gif).');
        inputAvatar.value = '';
        return;
      }
      if(file.size > maxBytes){
        alert('Image too large. Please pick an image under 3 MB.');
        inputAvatar.value = '';
        return;
      }

      const reader = new FileReader();
      reader.onload = function(ev){
        const dataUrl = ev.target.result;
        // show modal preview immediately
        if(modalPreview) modalPreview.src = dataUrl;
        // optionally autosave preview to localStorage? we'll save on form submit
      };
      reader.readAsDataURL(file);
    });
  }
 if(removeAvatarBtn){
    removeAvatarBtn.addEventListener('click', function(e){
      e.preventDefault();
      // clear saved avatar in localStorage
      try{ localStorage.removeItem(LS_AVATAR); } catch(err){ console.warn(err); }
      // revert images to original defaults
      if(avatarLarge) avatarLarge.src = DEFAULT_LARGE_SRC;
      if(avatarMini) avatarMini.src = DEFAULT_MINI_SRC;
      if(modalPreview) modalPreview.src = DEFAULT_LARGE_SRC;
      // also clear file selection
      if(inputAvatar) inputAvatar.value = '';
      alert('Profile photo removed (reverted to default).');
    });
  }

  // Event bindings
   editBtn.addEventListener('click', function(e){ e.preventDefault(); openModal(); });
  closeTriggers.forEach(btn => btn.addEventListener('click', function(e){ e.preventDefault(); closeModal(); }));
  modal.addEventListener('click', function(e){
    if(e.target === modal.querySelector('.modal-backdrop')) closeModal();
  });
  document.addEventListener('keydown', function(e){ if(e.key === 'Escape' && !modal.hidden) closeModal(); });

  

  // handle submit
  form.addEventListener('submit', function(e){
    // Add this inside the submit event listener
const titleVal = document.getElementById('inputTitle').value || 'Member';
localStorage.setItem('beanthere_profile_title', titleVal);
if(document.querySelector('.ud-sub')) document.querySelector('.ud-sub').textContent = titleVal;
    e.preventDefault();

    let usernameVal = inputUsername.value || '';
    let bioVal = inputBio.value || '';
    usernameVal = normalizeUsername(usernameVal);
    if(usernameVal.length < 2){
      alert('Please enter a valid username (e.g. @erylle_g).');
      inputUsername.focus();
      return;
    }
    // update DOM
     if(handleText) handleText.textContent = usernameVal;
    if(bioText) bioText.textContent = bioVal;

    // Save username + bio
    try{
      localStorage.setItem(LS_USER, usernameVal);
      localStorage.setItem(LS_BIO, bioVal);
    }catch(err){ console.warn('Could not save to localStorage:', err); }
     const file = inputAvatar.files && inputAvatar.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = function(ev){
        const dataUrl = ev.target.result;
        // Update both avatar images
        if(avatarLarge) avatarLarge.src = dataUrl;
        if(avatarMini) avatarMini.src = dataUrl;
        if(modalPreview) modalPreview.src = dataUrl;
        // save to localStorage
        try{ localStorage.setItem(LS_AVATAR, dataUrl); } catch(err){ console.warn(err); }
      };
      reader.readAsDataURL(file);
    }
    
    closeModal();
  });
  window.addEventListener('DOMContentLoaded', loadSaved);
})();
    // example: keep search click working (you can add real search logic)
    document.getElementById('searchBtn').addEventListener('click', function () {
      const q = document.getElementById('q').value.trim();
      alert(q ? 'Searching for: ' + q : 'Please type a search term');
    });
    (function(){
    const btn = document.getElementById('userMenuBtn');
    const panel = document.getElementById('userDropdown');

    function openPanel(){ 
      panel.hidden = false; 
      btn.setAttribute('aria-expanded','true');
      // put focus on first menu element for keyboard users
      const first = panel.querySelector('[role="menuitem"]');
      if(first) first.focus();
    }
    function closePanel(){ 
      panel.hidden = true; 
      btn.setAttribute('aria-expanded','false'); 
      btn.focus();
    }
    function togglePanel(){
      if(panel.hidden) openPanel(); else closePanel();
    }

    // toggle when clicking the avatar button
    btn.addEventListener('click', function(e){
      e.stopPropagation();
      togglePanel();
    });

    // Close on outside click
    document.addEventListener('click', function(e){
      if(!panel.hidden && !panel.contains(e.target) && !btn.contains(e.target)){
        closePanel();
      }
    });

    // Close on Escape key
    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape' && !panel.hidden){ closePanel(); }
    });

    // handle menu actions
    panel.addEventListener('click', function(e){
      const actionBtn = e.target.closest('button[data-action]');
      if(!actionBtn) return;
      const action = actionBtn.getAttribute('data-action');

      if(action === 'profile') {
        window.location.href = 'profile.html';
      } else if(action === 'contact') {
        window.location.href = 'contact.html'; // change target if you have a different page
      } else if(action === 'support') {
        window.location.href = 'support.html'; // change target as needed
      } else if(action === 'signout') {
        // sign out -> redirect to homepage (index.html)
        window.location.href = 'index.html';
      }
    });

    // allow keyboard activation of button (space/enter is default for button)
    // optional: trap focus inside dropdown while open (simple approach)
    panel.addEventListener('keydown', function(e){
      const focusable = Array.from(panel.querySelectorAll('[role="menuitem"]'));
      if(!focusable.length) return;

      const idx = focusable.indexOf(document.activeElement);
      if(e.key === 'ArrowDown'){
        e.preventDefault();
        const next = focusable[(idx + 1) % focusable.length];
        next.focus();
      } else if(e.key === 'ArrowUp'){
        e.preventDefault();
        const prev = focusable[(idx - 1 + focusable.length) % focusable.length];
        prev.focus();
      }
    });
  })();
  </script>

  <script>
    (function(){
        // Sample Data for Reviews
        let reviewsData = [
            {
                id: 513111, // Changed ID to match your image example
                cafeName: "Yardstick",
                address: "Universal LMS Building, 106 Esteban, Makati City, Metro Manila",
                rating: 4,
                date: "February 28, 2026",
                editedOn: null,
                text: "Bro, what do you mean you haven't tried Yardstick? Sa bagay, if you know, you know lang naman. Solid talaga yung beans nila! Balanced, hindi maasim, hindi rin flat. Perfect for people who actually taste their coffee and not just drink it for caffeine. Perfect for quiet conversations or just zoning out with a cup. Definitely a go-to if you're serious about coffee like me.",
                image: "apdev-tbv/cafe4.jpg", 
                amenities: { ac: true, socket: true, wifi: true, altMilk: true }
            },
            {
                id: 2,
                cafeName: "The Spotted Pig",
                address: "Salcedo Village, Makati",
                rating: 5,
                date: "January 15, 2026",
                editedOn: "January 16, 2026 at 10:30am",
                text: "Absolutely love this spot. The vibe is immaculate, and the pour-over selection is top-tier. It gets a bit crowded on weekends, but worth the wait.",
                image: "apdev-tbv/thespottedpig.jpeg",
                amenities: { ac: true, socket: false, wifi: true, altMilk: true }
            },
            {
                id: 3,
                cafeName: "Daily Dose",
                address: "Ortigas Center, Pasig",
                rating: 3,
                date: "December 10, 2025",
                editedOn: null,
                text: "Decent coffee for a quick fix, but nothing mind-blowing. Good for working as they have lots of outlets.",
                image: "apdev-tbv/dailydose.jpg",
                amenities: { ac: true, socket: true, wifi: true, altMilk: false }
            }
        ];
        // --- NEW: Sample Data for Replies ---
        // --- UPDATED: Sample Data for Replies ---
        // --- UPDATED: Sample Data for Replies ---
        const repliesData = [
            {
                id: 901,
                replyToUser: "Mark S.",
                cafeName: "Yardstick",
                date: "March 2, 2026",
                text: "Hey Mark! Totally agree about Yardsrick's iced latte. It's my go-to on a hot afternoon. Have you tried their pastries? The croissants are surprisingly good!",
                image: "apdev-tbv/cafe4.jpg"
            },
            {
                id: 902,
                replyToUser: "CoffeeCat_99",
                cafeName: "The Spotted Pig",
                date: "February 25, 2026",
                text: "I had the same experience! The queue was long, but that hazelnut hot chocolate made it all worth it. Did you find it too noisy for working, though?",
                image: "apdev-tbv/thespottedpig.jpeg"
            },
            {
                id: 903,
                replyToUser: "Juan Dela Cruz",
                cafeName: "Daily Dose",
                date: "February 10, 2026",
                text: "This branch is definitely the best for people-watching. I haven't tried the ice cream sandwiches yet‚Äîadding that to my list for next time!",
                image: "apdev-tbv/dailydose.jpg"
            }
        ];

        // --- FIXED: Select the Reply Buttons ---
        const repliesContainer = document.getElementById('repliesContainer');
        const prevReplyBtn = document.getElementById('prevReplyBtn');
        const nextReplyBtn = document.getElementById('nextReplyBtn');
        let currentReplyIndex = 0; 

        function renderSampleReplies() {
            const reply = repliesData[currentReplyIndex];
            const username = getCurrentUsername();

            const replyHtml = `
                <div class="review-card" style="box-shadow: none; width: 100%;">
                  <img src="${reply.image}" alt="${reply.cafeName}" class="review-img">
                  <div class="review-content">
                    <div class="review-header" style="margin-bottom: 4px;">
                      <div>
                        <span class="review-user">${username.replace('@', '')}</span>
                        <span style="color: var(--muted); font-size: 14px;"> replying to </span>
                        <span class="review-user">${reply.replyToUser}</span>
                        <span class="review-date" style="margin-top: 4px;">${reply.date}</span>
                      </div>
                    </div>
                    
                    <div class="cafe-title-row">
                        <h3 class="cafe-name" style="font-size: 24px;">${reply.cafeName}</h3>
                    </div>
                    <p class="review-text" style="margin-top: 12px;">${reply.text}</p>
                  </div>
                </div>
            `;
            repliesContainer.innerHTML = replyHtml;

            // --- FIXED: Update Arrow Visibility ---
            // If we are at the start, dim the left arrow
            prevReplyBtn.style.opacity = currentReplyIndex === 0 ? "0.5" : "1";
            prevReplyBtn.style.cursor = currentReplyIndex === 0 ? "default" : "pointer";
            
            // If we are at the end, dim the right arrow
            nextReplyBtn.style.opacity = currentReplyIndex === repliesData.length - 1 ? "0.5" : "1";
            nextReplyBtn.style.cursor = currentReplyIndex === repliesData.length - 1 ? "default" : "pointer";
        }

        // --- FIXED: Add Click Listeners ---
        prevReplyBtn.addEventListener('click', () => {
            if (currentReplyIndex > 0) {
                currentReplyIndex--;
                renderSampleReplies();
            }
        });

        nextReplyBtn.addEventListener('click', () => {
            if (currentReplyIndex < repliesData.length - 1) {
                currentReplyIndex++;
                renderSampleReplies();
            }
        });

        // Call the initial render
        renderSampleReplies();

        let currentReviewIndex = 0;
        const reviewContainer = document.getElementById('reviewContainer');
        const prevBtn = document.getElementById('prevReviewBtn');
        const nextBtn = document.getElementById('nextReviewBtn');

        // --- NEW: Edit Review Modal Elements ---
        const editReviewModal = document.getElementById('editReviewModal');
        const editReviewForm = document.getElementById('editReviewForm');
        const editReviewText = document.getElementById('editReviewText');
        const editReviewTitle = document.getElementById('editReviewTitle');
        const closeReviewTriggers = document.querySelectorAll('[data-close-review]');
        let reviewIdToEdit = null;


        // Helper to get current username from localStorage
        function getCurrentUsername() {
            const storedUser = localStorage.getItem('beanthere_profile_username');
            return storedUser ? storedUser : '@erylle_g'; 
        }

        // Helper to generate bean rating icons
        function getBeanRatingHtml(rating) {
            let beansHtml = '';
            for (let i = 0; i < 5; i++) {
                beansHtml += i < rating ? '‚òï' : '<span style="opacity:0.3; filter:grayscale(1)">‚òï</span>';
            }
            return beansHtml;
        }

        // Helper to generate amenities icons
        function getAmenitiesHtml(amenities) {
            let html = '';
            if (amenities.ac) html += '<div class="amenity-item">‚ùÑÔ∏è Air-conditioned</div>';
            if (amenities.socket) html += '<div class="amenity-item">üîå Socket</div>';
            if (amenities.wifi) html += '<div class="amenity-item">üõú Wifi</div>';
            if (amenities.altMilk) html += '<div class="amenity-item">ü•õ Alt Milk</div>';
            return html;
        }

        function renderReview(index) {
            if (index < 0 || index >= reviewsData.length) return;
            
            const review = reviewsData[index];
            const username = getCurrentUsername();
            const beansHtml = getBeanRatingHtml(review.rating);
            const amenitiesHtml = getAmenitiesHtml(review.amenities);

            let editedHtml = '';
            if (review.editedOn) {
                // The date string is now pre-formatted
                editedHtml = `<span class="edited-label">edited on ${review.editedOn}</span>`;
            }

            const reviewHtml = `
                <div class="review-card" data-id="${review.id}">
                  <img src="${review.image}" alt="${review.cafeName}" class="review-img">
                  <div class="review-content">
                    <div class="review-header">
                      <div>
                        <div class="review-user">${username.replace('@', '')}</div>
                        <span class="review-date">${review.date}</span>
                        ${editedHtml}
                      </div>
                      <div class="amenities-list">
                        ${amenitiesHtml}
                      </div>
                    </div>
                    
                    <div class="cafe-title-row">
                        <h3 class="cafe-name">${review.cafeName}</h3>
                        <span class="rating-beans">${beansHtml}</span>
                    </div>
                    <div class="cafe-address">${review.address}</div>
                    <p class="review-text">${review.text}</p>
                    
                    <div class="edit-review-btn-container">
                        <button class="btn-edit-review" id="editReviewBtn-${review.id}">Edit Review</button>
                    </div>
                  </div>
                </div>
            `;

            reviewContainer.innerHTML = reviewHtml;

            document.getElementById(`editReviewBtn-${review.id}`).addEventListener('click', function() {
                openReviewModal(review.id);
            });
        }

        // --- NEW: Modal Functions ---
        function openReviewModal(reviewId) {
            const review = reviewsData.find(r => r.id === reviewId);
            if (!review) return;

            reviewIdToEdit = reviewId;
            editReviewText.value = review.text;
            // Update the title with the review ID
            // Just set the title text without the ID
            editReviewTitle.textContent = "Edit Review";
            
            editReviewModal.hidden = false;
            // Small delay to ensure focus works
            setTimeout(() => editReviewText.focus(), 50);
        }

        function closeReviewModal() {
            editReviewModal.hidden = true;
            reviewIdToEdit = null;
            editReviewText.value = ''; // Clear textarea
        }

        // Event listeners for closing the modal (X button and backdrop)
        closeReviewTriggers.forEach(trigger => {
            trigger.addEventListener('click', function(e) {
                e.preventDefault();
                closeReviewModal();
            });
        });
        
        // Close on Escape key
        document.addEventListener('keydown', function(e){
            if(e.key === 'Escape' && !editReviewModal.hidden) {
                closeReviewModal();
            }
        });

        // Handle form submission (Save button)
        editReviewForm.addEventListener('submit', function(e) {
            e.preventDefault();
            if (reviewIdToEdit === null) return;

            const newText = editReviewText.value.trim();
            const reviewIndex = reviewsData.findIndex(r => r.id === reviewIdToEdit);

            // Only update if the text has actually changed
            if (reviewIndex !== -1 && newText !== reviewsData[reviewIndex].text) {
                // Update text
                reviewsData[reviewIndex].text = newText;
                
                // Format current date and time for "Edited on"
                const now = new Date();
                const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
                const datePart = now.toLocaleDateString('en-US', dateOptions);
                
                // Format time like 7:23pm
                let hours = now.getHours();
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const ampm = hours >= 12 ? 'pm' : 'am';
                hours = hours % 12;
                hours = hours ? hours : 12; // the hour '0' should be '12'
                const timeString = `${hours}:${minutes}${ampm}`;
                
                reviewsData[reviewIndex].editedOn = `${datePart} at ${timeString}`;
                
                // Re-render the review card to show changes
                renderReview(currentReviewIndex);
            }
            // Close the modal after saving
            closeReviewModal();
        });

        // Carousel Navigation
        prevBtn.addEventListener('click', () => {
            if (currentReviewIndex > 0) {
                currentReviewIndex--;
                renderReview(currentReviewIndex);
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentReviewIndex < reviewsData.length - 1) {
                currentReviewIndex++;
                renderReview(currentReviewIndex);
            }
        });

        // Initial Render
        renderReview(currentReviewIndex);
    })();
  </script>
</body>
</html>